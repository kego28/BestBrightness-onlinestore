<!-- <ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Account</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div *ngIf="loading" class="ion-text-center ion-padding">
    <ion-spinner></ion-spinner>
    <p>Loading user information...</p>
  </div>

  <div *ngIf="!loading">
    <div *ngIf="error" class="ion-text-center ion-padding">
      <ion-text color="danger">
        <p>{{ error }}</p>
      </ion-text>
    </div>

    <ion-card *ngIf="currentUser">
      <ion-card-header>
        <ion-card-title>Profile Information</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-label>
              <h2>Name</h2>
              <p>{{currentUser.first_name}} {{currentUser.last_name}}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h2>Username</h2>
              <p>{{currentUser.username}}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h2>Email</h2>
              <p>{{currentUser.email}}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h2>Role</h2>
              <p>{{currentUser.role}}</p>
            </ion-label>
          </ion-item>
        </ion-list>

        <ion-button expand="block" color="primary" class="ion-margin-top" (click)="logout()">
          Logout
        </ion-button>
      </ion-card-content>
    </ion-card>

    <Orders Section -->
    <!-- <ion-card *ngIf="allOrders.length > 0">
      <ion-card-header>
        <ion-card-title>Your Orders</ion-card-title>
      </ion-card-header> -->
      
      <!-- <ion-card-content>
        <ion-select [(ngModel)]="selectedStatus" (ionChange)="onStatusChange()">
          <ion-select-option value="all">All</ion-select-option>
          <ion-select-option value="pending">Pending</ion-select-option>
          <ion-select-option value="order-processed">Processed</ion-select-option>
          <ion-select-option value="checked-out">Checked Out</ion-select-option>
        </ion-select> -->

        <!-- <ion-list>
          <ion-item *ngFor="let order of displayedOrders">
            <ion-label>
              <h2>Order #{{ order.order_id }} - {{ order.status }}</h2>
              <p>Type: {{ order.order_type }}</p>
              <p>Amount: R{{ order.total_amount }}</p>
              <p>Created At: {{ order.created_at | date:'short' }}</p>
            </ion-label>
          </ion-item>
        </ion-list> -->

        <!-- <ion-button *ngIf="!showAllOrders && allOrders.length > 3" expand="block" fill="clear" (click)="toggleShowAllOrders()">
          Show More
        </ion-button>
        <ion-button *ngIf="showAllOrders" expand="block" fill="clear" (click)="toggleShowAllOrders()">
          Show Less
        </ion-button>
      </ion-card-content>
    </ion-card> -->

    <!-- No Orders Found -->
    <!-- <div *ngIf="allOrders.length === 0 && !ordersLoading && !ordersError" class="ion-text-center ion-padding">
      <h2>No Orders Found</h2>
      <p>You haven't placed any orders yet.</p>
    </div> -->

    <!-- Error Section -->
    <!-- <div *ngIf="ordersError" class="ion-text-center ion-padding">
      <ion-text color="danger">
        <p>{{ ordersError }}</p>
      </ion-text>
    </div> -->

    <!-- Loading Spinner -->
    <!-- <ion-spinner *ngIf="ordersLoading" class="ion-padding"></ion-spinner>
  </div>
</ion-content>  

<ion-content>

<div *ngIf="loading" class="loading-container">
  <ion-spinner></ion-spinner>
  <p>Loading user information...</p>
</div>

<div *ngIf="!loading && currentUser">
  <div class="hero-section">
    <h1 class="hero-title">MY ACCOUNT</h1>
  </div>
  <div class="nav-cards">
    <div class="nav-card" (click)="viewOrders()">
      <ion-icon name="cart-outline"></ion-icon>
      <span>ORDERS</span>
    </div>

    <div class="nav-card" (click)="editAccount()">
      <ion-icon name="person-outline"></ion-icon>
      <span>EDIT ACCOUNT</span>
    </div>

    <div class="nav-card" (click)="viewAddress()">
      <ion-icon name="home-outline"></ion-icon>
      <span>ADDRESS</span>
    </div>

    <div class="nav-card" (click)="logout()">
      <ion-icon name="log-out-outline" ></ion-icon>
      <span>LOGOUT</span>
    </div>
  </div>
  
  <div class="orders-section" *ngIf="activeSection === 'orders'">
    <div *ngIf="ordersLoading" class="loading-container">
      <ion-spinner></ion-spinner>
        <p>Loading orders...</p>
      </div>

      <div *ngIf="!ordersLoading">
        <ion-select [(ngModel)]="selectedStatus" (ionChange)="onStatusChange()" class="status-select">
          <ion-select-option value="all">All Orders</ion-select-option>
          <ion-select-option value="pending">Pending</ion-select-option>
          <ion-select-option value="order-processed">Processed</ion-select-option>
          <ion-select-option value="checked-out">Checked Out</ion-select-option>
        </ion-select>

    <div class="orders-table" *ngIf="displayedOrders.length > 0">
<table>
      <thead>
        <tr>
          <th>Order</th>
          <th>Date</th>
          <th>Status</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of displayedOrders">
          <td>#{{order.order_id}}</td>
          <td>{{order.created_at | date:'mediumDate'}}</td>
          <td>{{order.status}}</td>
          <td>R{{order.total_amount}}</td>
          <td>{{order.order_type}}</td>
            <!--
        </tr>
      </tbody>
    </table>
  
    <ion-button *ngIf="!showAllOrders && allOrders.length > 3"expand="block" fill="clear" (click)="toggleShowAllOrders()">Show More
    </ion-button>
    <ion-button *ngIf="showAllOrders" expand="block" fill="clear" (click)="toggleShowAllOrders()">
Show Less</ion-button>
</div>
<div *ngIf="displayedOrders.length === 0" class="no-orders">
  <p>No orders found</p>
</div>
</div>
</div>

  <div class="edit-account-section" *ngIf="activeSection === 'edit'">
    <form [formGroup]="accountForm" (ngSubmit)="updateAccount()">
      <ion-item>
        <ion-label position="floating">First Name</ion-label>
        <ion-input formControlName="firstName" type="text"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Last Name</ion-label>
        <ion-input formControlName="lastName" type="text"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Email</ion-label>
        <ion-input formControlName="email" type="email"></ion-input>
      </ion-item>

      <ion-button expand="block" type="submit" [disabled]="!accountForm.valid">
        Save Changes
      </ion-button>
    </form>
  </div>

  <div class="address-section" *ngIf="activeSection === 'address'">
    <form [formGroup]="addressForm" (ngSubmit)="updateAddress()">
      <ion-item>
        <ion-label position="floating">Street Address</ion-label>
        <ion-input formControlName="street" type="text"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">City</ion-label>
        <ion-input formControlName="city" type="text"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Postal Code</ion-label>
        <ion-input formControlName="postalCode" type="text"></ion-input>
      </ion-item>

      <ion-button expand="block" type="submit" [disabled]="!addressForm.valid">
        Update Address
      </ion-button>
    </form>
  </div>
  <div *ngIf="error" class="error-container">
    <ion-text color="danger">
      <p>{{ error }}</p>
    </ion-text>
  </div>
</div>
</ion-content>-->

<ion-content class="account-page">
  <!-- Loading Overlay -->
  <div *ngIf="loading" class="loading-overlay">
    <ion-spinner name="circles"></ion-spinner>
  </div>

  <div *ngIf="!loading && currentUser" class="page-content">
    <!-- Profile Header -->
    <div class="profile-header">
      <!-- <div class="profile-image">
        <img [src]="currentUser.profileImage || 'assets/default-avatar.png'" alt="Profile Picture">
      </div> -->
      <h1>{{ currentUser.first_name }} {{ currentUser.last_name }}</h1>
      <p>{{ currentUser.email }}</p>
    </div>

    <!-- Quick Stats -->
    <ion-grid class="quick-stats">
      <ion-row>
        <ion-col>
          <div class="stat-box">
            <ion-icon name="cart"></ion-icon>
            <span class="stat-value">{{ totalOrders }}</span>
            <span class="stat-label">Orders</span>
          </div>
        </ion-col>
        <ion-col>
          <div class="stat-box">
            <ion-icon name="star"></ion-icon>
            <span class="stat-value">{{ loyaltyPoints }}</span>
            <span class="stat-label">Points</span>
          </div>
        </ion-col>
        <ion-col>
          <div class="stat-box">
            <ion-icon name="heart"></ion-icon>
            <span class="stat-value">{{ wishlistItems }}</span>
            <span class="stat-label">Wishlist</span>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Main Navigation -->
    <ion-segment (ionChange)="segmentChanged($event)" value="orders" class="main-nav">
      <ion-segment-button value="orders">
        <ion-label>Orders</ion-label>
      </ion-segment-button>
      <ion-segment-button value="account">
        <ion-label>Account</ion-label>
      </ion-segment-button>
      <ion-segment-button value="address">
        <ion-label>Address</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- Orders Section -->
    <div *ngIf="activeSection === 'orders'" class="section-content">
      <ion-searchbar placeholder="Search orders" (ionInput)="searchOrders($event)"></ion-searchbar>
      
      <ion-list>
        <ion-item *ngFor="let order of displayedOrders" class="order-item">
          <!-- <ion-thumbnail slot="start">
            <img [src]="order.productImage || 'assets/default-product.png'" alt="Product">
          </ion-thumbnail> -->
          <ion-label>
            <h2>Order #{{ order.order_id }}</h2>
            <p>{{ order.created_at | date:'mediumDate' }}</p>
            <ion-badge [color]="getStatusColor(order.status)">{{ order.status }}</ion-badge>
          </ion-label>
          <ion-note slot="end">
            <strong>R{{ order.total_amount }}</strong>
            <!-- (click)="viewOrderDetails(order)" -->
            <!-- <ion-button fill="clear" slot="end">
              View
            </ion-button> -->
          </ion-note>
        </ion-item>
      </ion-list>

      <ion-infinite-scroll (ionInfinite)="loadMoreOrders($event)">
        <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more orders...">
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </div>

    <!-- Account Section -->
    <div *ngIf="activeSection === 'account'" class="section-content">
      <form [formGroup]="accountForm" (ngSubmit)="updateAccount()">
        <ion-list lines="full" class="ion-no-margin ion-no-padding">
          <ion-item>
            <ion-label position="stacked">Username</ion-label>
            <ion-input formControlName="username" type="text" placeholder="Enter your username"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">First Name</ion-label>
            <ion-input formControlName="firstName" type="text" placeholder="Enter your first name"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Last Name</ion-label>
            <ion-input formControlName="lastName" type="text" placeholder="Enter your last name"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Email</ion-label>
            <ion-input formControlName="email" type="email" placeholder="Enter your email"></ion-input>
          </ion-item>
        </ion-list>
        <div class="ion-padding">
          <ion-button expand="block" type="submit" [disabled]="!accountForm.valid" class="save-button">
            Save Changes
          </ion-button>
        </div>
      </form>
    </div>

    <!-- Address Section -->
    <div *ngIf="activeSection === 'address'" class="section-content">
      <form [formGroup]="addressForm" (ngSubmit)="updateAddress()">
        <ion-list lines="full" class="ion-no-margin ion-no-padding">
          <ion-item>
            <ion-label position="stacked">Street Address</ion-label>
            <ion-input formControlName="street" type="text" placeholder="Enter your street address"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">City</ion-label>
            <ion-input formControlName="city" type="text" placeholder="Enter your city"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">State/Province</ion-label>
            <ion-input formControlName="state" type="text" placeholder="Enter your state or province"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Postal Code</ion-label>
            <ion-input formControlName="postalCode" type="text" placeholder="Enter your postal code"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Country</ion-label>
            <ion-select formControlName="country" placeholder="Select your country">
              <ion-select-option value="za">South Africa</ion-select-option>
              <!-- Add more countries as needed -->
            </ion-select>
          </ion-item>
        </ion-list>
        <div class="ion-padding">
          <ion-button expand="block" type="submit" [disabled]="!addressForm.valid" class="save-button">
            Update Address
          </ion-button>
        </div>
      </form>
    </div>
  </div>

  <!-- Logout Button -->
  <ion-button expand="block" (click)="logout()" class="logout-button">
    Logout
  </ion-button>

  <!-- Error Toast -->
  <ion-toast
    [isOpen]="error !== null"
    [message]="error"
    [duration]="3000"
    position="bottom"
    color="danger"
  ></ion-toast>
</ion-content>